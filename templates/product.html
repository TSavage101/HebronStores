{% load static %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Product</title>
    <link rel="stylesheet" href="{% static 'nav.css' %}">
    <link rel="stylesheet" href="{% static 'product.css' %}">
    <link rel="stylesheet" href="{% static '/fontawesome-free-5.15.3-web/CSS/ALL.CSS' %}">
    <script src="{% static 'jquery.js' %}" type="text/javascript"></script>
    <script src="{% static 'jquery.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'home.js' %}"></script>
</head>

<body>
    <div class="container">
        <nav>
            <div class="left-side">
                <a href="#" class="logo"><img src="{% static 'images/logob.png' %}" alt=""></a>
            </div>
            <div class="right-side">
                <ul>
                    <li><a href="{% url 'home' %}">Home</a></li>
                    <li><a href="{% url 'categories' %}">Catergories</a></li>
                    <li><a href="">Contact</a></li>
                    <li><a href="">FAQ</a></li>
                </ul>
                <div class="icons">
                    <a href="#" class="notifBtn" title="My Notifications"> <i class="fas fa-bell"></i></a>
                    <a href="#" class="userBtn" title="Me"> <i class="fas fa-user"></i></a>
                </div>
            </div>
        </nav>
        <div class="buyproduct top-picks all-products">
            <div class="part product-image">
                <div class="main-image">
                    <img src="{{ product.picture1.url }}" alt="">
                    <div class="image-roll">
                        <div class="image img1">
                            <img src="{{ product.picture1.url }}" alt="">
                        </div>
                        <div class="image img1">
                            <img src="{{ product.picture2.url }}" alt="">
                        </div>
                        <div class="image img1">
                            <img src="{{ product.picture3.url }}" alt="">
                        </div>
                        <div class="image img1">
                            <img src="{{ product.picture4.url }}" alt="">
                        </div>
                        <div class="image img1">
                            <img src="{{ product.picture5.url }}" alt="">
                        </div>
                    </div>
                </div>
            </div>
            <div class="part product-details">
                <h1>{{ product.name }}</h1>
                <p class="seller">{{ product.seller }}</p>
                <div class="other-details">
                    <div class="price">
                        <h3>
                            <div class="currency">N</div>{{ product.price }}</h3>
                    </div>
                    <div class="rating">
                        {{ product.arating }}
                        <i class="fas fa-star"></i>
                    </div>
                </div>
                <div class="quantity">
                    <button class="minus">-</button>
                    <div class="no"><input name="" class="number" id="num" type="number" value="" readonly></div>
                    <button class="plus">+</button>
                </div>
                <div class="reviews">
                    <div class="review-overflow" style="overflow: scroll;">
                        <div class="all-reviews" >
                            {% if all_reviews|length > 0 %}
                              {% for review in all_reviews %}
                                <h3 style="color: #3c3c3c;">{{ review.user }}</h3>
                                <div class="" style="color: #b82b84; font-size: smaller;">
                                    {% if review.rating == 1 %}
                                        <i class="fa fa-star" ></i>
                                        <i class="far fa-star" ></i>
                                        <i class="far fa-star" ></i>
                                        <i class="far fa-star" ></i>
                                        <i class="far fa-star" ></i>
                                    {% endif %}
                                    {% if review.rating == 2 %}
                                        <i class="fa fa-star" ></i>
                                        <i class="fa fa-star" ></i>
                                        <i class="far fa-star" ></i>
                                        <i class="far fa-star" ></i>
                                        <i class="far fa-star" ></i>
                                    {% endif %} 
                                    {% if review.rating == 3 %}
                                        <i class="fa fa-star" ></i>
                                        <i class="fa fa-star" ></i>
                                        <i class="fa fa-star" ></i>
                                        <i class="far fa-star" ></i>
                                        <i class="far fa-star" ></i>
                                    {% endif %} 
                                    {% if review.rating == 4 %}
                                        <i class="fa fa-star" ></i>
                                        <i class="fa fa-star" ></i>
                                        <i class="fa fa-star" ></i>
                                        <i class="fa fa-star" ></i>
                                        <i class="far fa-star" ></i>
                                    {% endif %} 
                                    {% if review.rating == 5 %}
                                        <i class="fa fa-star" ></i>
                                        <i class="fa fa-star" ></i>
                                        <i class="fa fa-star" ></i>
                                        <i class="fa fa-star" ></i>
                                        <i class="fa fa-star" ></i>
                                    {% endif %}
                                    </div>
                                <p style="color: #555555;">{{ review.comment }}</p><br>
                              {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                    <button class="addReview"><i class="fas fa-pen"></i>Add a Review</button>
                </div>
                <div class="buttons">
                    <div class="button">
                        <div class="drop">
                            <i>></i>
                        </div>
                        <button class="buyBtn">Buy <div class="currency">N</div><div class="pay"></div></button>
                        <button class="orderBtn">Pay On Deilivery</button>
                    </div>

                    <div class="button">
                        <form id="addtocart">
                            <input type="hidden" name="atc" />
                            <div id="adrbtn">

                            </div>
                        </form>
                    </div>

                </div>
            </div>
            <div class="write-review-bg">
                <form id="" action="" method="POST"> {% csrf_token %}
                    <div class="write-review">
                        <span class="closeBtn"><i class="fas fa-times"></i></span>
                        <div class="rate">
                            <div class="star s1"></div>
                            <div class="star s2"></div>
                            <div class="star s3"></div>
                            <div class="star s4"></div>
                            <div class="star s5"></div>
                        </div>
                        <input type="hidden" name="rating" value="{{ robj.rating }}" id="rrr" />
                        <textarea name="review" type="" class="write" id="review" cols="30" rows="10" placeholder="Tell Us Something(Optional)" style="padding: 10px;">{{ robj.comment }}</textarea>
                        <button type="submit">Add Review</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="seller-card">
        <a href="#" class="close"><i class="fas fa-times"></i></a>
        <i class="fas fa-user"></i>
        <h1>{{ seller.user.username }}</h1>
        <div class="seller-rating">
            {{ seller.average_product_rating }}
            <i class="fas fa-star"></i>
        </div>
        <div class="contacts">
            <div class="contact">
                <div class="text" style="float: right;">{{ seller.instagram }}</div>
                <div class="logo"><i class="fab fa-instagram"></i></div>
            </div>
            <div class="contact">
                <div class="text" style="float: right;">{{ seller.whatsapp }}</div>
                <div class="logo"><i class="fab fa-whatsapp"></i></div>
            </div>
            <div class="contact">
                <div class="text" style="float: right;">{{ seller.telegram }}</div>
                <div class="logo"><i class="fab fa-telegram"></i></div>
            </div>
            <div class="contact">
                <div class="text" style="float: right;">{{ user_obj.email }}</div>
                <div class="logo"><i class="fas fa-envelope"></i></div>
            </div>
        </div>
    </div>
    <button class="flotingcartBtn" title="Cart">
        <i class="fas fa-shopping-bag"></i>
    </button>
    <div class="sidebar">
        <div class="side-sec general">
            <i class="fas fa-user"></i>
            <h1><span>{{ request.user.username }}</span></h1>
            <p>{{ request.user.email }}</p>
            <div class="buttons">
                <button class="logoutbtn1"><i class="fas fa-sign-out-alt"></i><a href="{% url 'logout' %}">Logout</a></button>
                <button class="deletebtn1"><i class="fas fa-cog"></i><a href="{% url 'socials' %}">Account Settings</a></button>
            </div>
            <button class="dashboardBtn">Seller Dashboard <i class="fas fa-external-link-alt"></i></button>
        </div>
        <div class="side-sec notifications">
            <h1>Notifications</h1>
            <div class="notification-area">
                <p>No notifications</p>
            </div>
        </div>
        <div class="side-sec cart">
            <h1>Cart</h1>
            <div class="cart-area">
                <p>No Items</p>
            </div>
        </div>
        <div class="side-sec history">
            <h1>Shopping History</h1>
            <div class="history-area">
                <p>No Items</p>
            </div>
        </div>
        <a href="#" class="sideClose"><i class="fas fa-times"></i></a>
        <div class="acc-options">
            <a href="#" class="sideCart" title="Cart"><i class="fas fa-shopping-bag"></i></a>
            <a href="#" class="sideHistory" title="shopping History"><i class="fas fa-clock"></i></a>
            <a href="#" class="sideNotif" title="My Notifications"><i class="fas fa-bell"></i></a>
        </div>
    </div>
    <script src="{% static '/buyproduct.js' %}"></script>
</body>
<script>

    $(document).on('submit', '#addtocart', function(e) {
        e.preventDefault();

        $.ajax({
            type: 'POST',
            url: "{% url 'product' product.pk  %}",
            data: {
                atc: $('#atc').val(),
                number: $('#num').val(),
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
            },
            success: function(data) {
                alert("Added to Cart!!!")
            },
            error: function(data) {
                alert("Something went wrong!!!")
            }
        });
    });

    $(document).ready(function() {

        setInterval(function() {
            $.ajax({
                type: 'GET',
                url: "{% url 'jsstuff' product.pk %}",
                success: function(response) {
                    // console.log(response);
                    $("#adrbtn").empty();
                    if (response.added.length == 0) {
                        var temp = '<button class="cartBtn"><i class="fas fa-plus"></i> Add to Cart</button>';
                    } else {
                        var temp = '<button class="cartBtn" disabled style="background: grey"> Added to Cart</button>';
                    }
                    $("#adrbtn").append(temp);
                },
                error: function(response) {
                    alert("An error occured when getting your data!!!")
                },
            });
        }, 1000);

    });

</script>

</html>